function Mouse(a){this.game=a,this.x=0,this.y=0,this.down=!1,this.up=!1;var b=this;this.moving=!1,this.interval=null,this.touches=[],this.element=document.getElementById("canvas"),Modernizr.touch?(console.log("Touch supported"),this.element.touchstart=function(a){b.onPointerDown(a)},this.element.touchmove=function(a){b.onPointerMove(a)},this.element.touchend=function(a){b.onPointerUp(a)},this.element.touchcancel=function(a){b.onPointerUp(a)},this.element.touchleave=function(a){b.onPointerUp(a)}):(console.log("Touch NOT supported"),this.element.onmousedown=function(a){b.onPointerDown(a)},this.element.onmousemove=function(a){b.onPointerMove(a)},this.element.onmouseup=function(a){b.onPointerUp(a)},this.element.onmouseout=function(a){b.onPointerUp(a)})}function Point2D(a,b){arguments.length>0&&(this.x=a,this.y=b)}function Piece(a,b,c,d,e,f){arguments.length>0?(this.id=a,this.game=b,this.img=c,this.position=e,this.initial=f,this.holder=d):(this.id=0,this.game=null,this.img=null,this.position=null,this.initial=null,this.target=null,this.holder=null,this.moveble=!1),this.m=(d.position.y-this.y)/(d.position.x-this.x),this.b=d.position.y-this.m*d.position.x,this.p=Math.random()>=.5?.1:-.1,this.tolerance=200,this.moveble=!0,this.moving=!1,this.placed=!1}function Holder(a,b,c,d,e){arguments.length>0?(this.id=a,this.game=b,this.img=c,this.position=d,this.moveble=e):(this.id=0,this.game=null,this.img=null,this.position=null,this.moveble=null)}function Game(){this.started=!1,this.stage=1,this.num_lines=2,this.scale=1,this.alpha=1,this.fade1=0,this.fade2=0,this.resized=!0,this.debug=!1,this.items_to_load=4,this.loaded_items=0,this.loaded=!1,this.interval=null,this.maxElapsedTime=0,this.start_time=0,this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=Math.round(window.innerWidth),this.canvas.height=Math.round(window.innerHeight),console.log("canvas: "+this.canvas.width+", "+this.canvas.height),this.original_width=this.canvas.width,this.original_height=this.canvas.height,this.font_size=Math.round(this.canvas.width/20),this.scaled_width=this.canvas.width/this.scale/2,this.scaled_height=this.canvas.height/this.scale/2,console.log("scaled_width: "+this.scaled_width),console.log("scaled_height: "+this.scaled_height),this.puzzle=new Puzzle("006",this,"images/006/2099024e.006.png",new Array("images/006/0ac7a950.p01.png","images/006/70159d53.p02.png","images/006/8c7f4331.p03.png","images/006/be7ec35f.p04.png"),new Array("images/006/63c55ae6.h01.png","images/006/76135a41.h02.png","images/006/c3dfc07f.h03.png","images/006/49c64cf3.h04.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-149+5,this.canvas.height/2-200+5),new Array(new Point2D(82,0),new Point2D(0,193),new Point2D(166,283),new Point2D(65,127))),this.loadAssets()}function Puzzle(a,b,c,d,e,f,g,h,i){this.pos=h,this.positions=i,this.num_pieces=i.length,this.remaining_time=30*this.num_pieces,this.time_to_complete=this.remaining_time,this.items_to_load=2*this.num_pieces+1,this.loaded_items=0,this.id=a,this.game=b,this.pieces=new Array,this.holders=new Array,this.position=null,f&&(this.has_voice=f.has_voice,this.has_sound=f.has_sound),g&&(this.width=g.width,this.height=g.height),this.image=c,this.imgp=d,this.imgh=e}function RunPrefixMethod(a,b){for(var c,d,e=["webkit","moz","ms","o",""],f=0;f<e.length&&!a[c];){if(c=b,""==e[f]&&(c=c.substr(0,1).toLowerCase()+c.substr(1)),c=e[f]+c,d=typeof a[c],"undefined"!=d)return e=[e[f]],"function"==d?a[c]():a[c];f++}}function start(){startGame()}function stop(){stopGame()}function pause(){pauseGame()}function restart(){restartGame()}function loop(){game.interval=window.requestAnimationFrame(loop,game.canvas),game.render();var a=game.getTimer()-game.time;game.time=game.getTimer(),a>game.maxElapsedTime&&(game.maxElapsedTime=a)}function loadAssetsI(g,assets){for(i=0;i<assets.length;i++)if(console.log("Loading: "+assets[i].slug),"image"==assets[i].type)eval("g."+assets[i].slug+" = new Image();"),eval("g."+assets[i].slug+'.src = "'+assets[i].src+'";'),eval("g."+assets[i].slug+".onload = g.loaded_items++;");else if("audio"==assets[i].type){eval("g."+assets[i].slug+" = document.createElement('audio');"),eval("g."+assets[i].slug+".addEventListener('canplaythrough', itemLoaded(g), false);");var source=document.createElement("source");Modernizr.audio.ogg?(source.type="audio/ogg",source.src=assets[i].src+".ogg"):Modernizr.audio.mp3&&(source.type="audio/mpeg",source.src=assets[i].src+".mp3"),""!=source.src?(eval("g."+assets[i].slug+".appendChild(source);"),console.log("g."+assets[i].slug+".appendChild(source);")):g.itens_to_load--}}function loadAssetsII(g,assets){for(i=0;i<assets.length;i++)if("image"==assets[i].type)eval("g."+assets[i].slug+" = new Image();"),eval("g."+assets[i].slug+'.src = "'+assets[i].src+'";'),eval("g."+assets[i].slug+".onload = g.loaded_items++;");else if("audio"==assets[i].type){eval("g."+assets[i].slug+" = document.createElement('audio');"),eval("g."+assets[i].slug+".addEventListener('canplaythrough', itemLoadedII(g), false);");var source=document.createElement("source");Modernizr.audio.ogg?(source.type="audio/ogg",source.src=assets[i].src+".ogg"):Modernizr.audio.mp3&&(source.type="audio/mpeg",source.src=assets[i].src+".mp3"),""!=source.src?eval("g."+assets[i].slug+".appendChild(source);"):g.itens_to_load2--}}function itemLoaded(a){a.loaded_items++}function itemLoadedII(a){a.loaded_items2++}function mediaSupport(a,b){var c=document.createElement(b);if("function"==typeof c.canPlayType){var d=c.canPlayType(a);if("maybe"==d.toLowerCase()||"probably"==d.toLowerCase())return!0}return!1}function resizeGame(){console.log("window: "+window.innerWidth+", "+window.innerHeight),game.started&&(game.resized=!0,game.init())}!function(a){function b(a,b,c,d){this.x=a,this.y=b,this.type=c,this.identifier=d}function c(a){a.target.mouseEvent=a}function d(a){a.target.mouseEvent=null}function e(a){a.target.touchList=a.targetTouches}function f(){var a=[];if(this.touchList)for(var c=0;c<this.touchList.length;c++){var d=this.touchList[c],e=new b(d.pageX,d.pageY,x.TOUCH,d.identifier);a.push(e)}return this.mouseEvent&&a.push(new b(this.mouseEvent.pageX,this.mouseEvent.pageY,x.MOUSE,w)),a}function g(a,b,c){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var e in c)d[e]=c[e];b.dispatchEvent(d)}function h(a){a.preventDefault(),c(a);var b={pointerType:"mouse",getPointerList:f.bind(this),originalEvent:a};g("pointerdown",a.target,b)}function i(a){a.preventDefault(),c(a);var b={pointerType:"mouse",getPointerList:f.bind(this),originalEvent:a};g("pointermove",a.target,b)}function j(a){a.preventDefault(),d(a);var b={pointerType:"mouse",getPointerList:f.bind(this),originalEvent:a};g("pointerup",a.target,b)}function k(a){a.preventDefault(),e(a);var b={pointerType:"touch",getPointerList:f.bind(this),originalEvent:a};g("pointerdown",a.target,b)}function l(a){a.preventDefault(),e(a);var b={pointerType:"touch",getPointerList:f.bind(this),originalEvent:a};g("pointermove",a.target,b)}function m(a){a.preventDefault(),e(a);var b={pointerType:"touch",getPointerList:f.bind(this),originalEvent:a};g("pointerup",a.target,b)}function n(a){a.preventDefault(),d(a)}function o(){log("pointerdown")}function p(){log("pointermove")}function q(){log("pointerup")}function r(a){a.isPointerEmitter||(s()?(a.addEventListener("touchstart",k),a.addEventListener("touchmove",l),a.addEventListener("touchend",m)):t()?(a.addEventListener("MSPointerDown",o),a.addEventListener("MSPointerMove",p),a.addEventListener("MSPointerUp",q)):(a.addEventListener("mousedown",h),a.addEventListener("mousemove",i),a.addEventListener("mouseup",j),a.addEventListener("mouseout",n)),a.isPointerEmitter=!0)}function s(){return Modernizr.touch}function t(){return!1}function u(a,b){var c=a.prototype.addEventListener;a.prototype.addEventListener=function(a,d,e){b.call(this,a,d,e),c.call(this,a,d,e)}}function v(a){0===a.indexOf("pointer")&&r(this)}var w=31337,x={TOUCH:"touch",MOUSE:"mouse"};navigator.userAgent.match(/Firefox/)?(u(HTMLDivElement,v),u(HTMLCanvasElement,v)):u(HTMLElement,v),a._createCustomEvent=g,a._augmentAddEventListener=u,a.PointerTypes=x}(window),function(a){function b(a){if(0===a.indexOf("gesture")){var b=Gesture._gestureHandlers[a];b?b(this):console.error("Warning: no handler found for {{evt}}.".replace("{{evt}}",a))}}navigator.userAgent.match(/Firefox/)?(window._augmentAddEventListener(HTMLDivElement,b),window._augmentAddEventListener(HTMLCanvasElement,b)):window._augmentAddEventListener(HTMLElement,b),a.Gesture=a.Gesture||{},a.Gesture._gestureHandlers=a.Gesture._gestureHandlers||{}}(window),function(a){function b(a){var b=new Date;if(b-this.lastDownTime<d){this.lastDownTime=0;var c={};window._createCustomEvent("gesturedoubletap",a.target,c)}this.lastDownTime=b}function c(a){a.addEventListener("pointerdown",b)}var d=300;a.Gesture._gestureHandlers.gesturedoubletap=c}(window),function(a){function b(a){this.longPressTimer=setTimeout(function(){payload={},window._createCustomEvent("gesturelongpress",a.target,payload)},f)}function c(){clearTimeout(this.longPressTimer)}function d(){clearTimeout(this.longPressTimer)}function e(a){a.addEventListener("pointerdown",b),a.addEventListener("pointermove",c),a.addEventListener("pointerup",d)}var f=600;a.Gesture._gestureHandlers.gesturelongpress=e}(window),function(a){function b(a,b){this.p1=a,this.p2=b}function c(a){var c=a.getPointerList();2==c.length&&(a.target.scaleReferencePair=new b(c[0],c[1]))}function d(a){var c=a.getPointerList();if(2==c.length&&a.target.scaleReferencePair){var d=new b(c[0],c[1]),e=d.scaleSince(a.target.scaleReferencePair);if(Math.abs(1-e)>g){var f={scale:e};window._createCustomEvent("gesturescale",a.target,f)}}}function e(a){a.target.scaleReferencePair=null}function f(a){a.addEventListener("pointerdown",c),a.addEventListener("pointermove",d),a.addEventListener("pointerup",e)}var g=.2;b.prototype.span=function(){var a=this.p1.x-this.p2.x,b=this.p1.y-this.p2.y;return Math.sqrt(a*a+b*b)},b.prototype.scaleSince=function(a){return this.span()/a.span()},a.Gesture._gestureHandlers.gesturescale=f}(window),function(a,b,c){function d(a){return"[object Function]"==q.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=r.shift();s=1,a?a.t?o(function(){("c"==a.t?m.injectCss:m.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):s=0}function i(a,c,d,e,f,i,j){function k(b){if(!n&&g(l.readyState)&&(t.r=n=1,!s&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&o(function(){v.removeChild(l)},50);for(var d in A[c])A[c].hasOwnProperty(d)&&A[c][d].onload()}}var j=j||m.errorTimeout,l={},n=0,q=0,t={t:d,s:c,e:f,a:i,x:j};1===A[c]&&(q=1,A[c]=[],l=b.createElement(a)),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,q)},r.splice(e,0,t),"img"!=a&&(q||2===A[c]?(v.insertBefore(l,u?null:p),o(k,j)):A[c].push(l))}function j(a,b,c,d,f){return s=0,b=b||"j",e(a)?i("c"==b?x:w,a,b,this.i++,c,d,f):(r.splice(this.i++,0,a),1==r.length&&h()),this}function k(){var a=m;return a.loader={load:j,i:0},a}var l,m,n=b.documentElement,o=a.setTimeout,p=b.getElementsByTagName("script")[0],q={}.toString,r=[],s=0,t="MozAppearance"in n.style,u=t&&!!b.createRange().compareNode,v=u?n:p.parentNode,n=a.opera&&"[object Opera]"==q.call(a.opera),n=!!b.attachEvent&&!n,w=t?"object":n?"script":"img",x=n?"script":w,y=Array.isArray||function(a){return"[object Array]"==q.call(a)},z=[],A={},B={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};m=function(a){function b(a){var b,c,d,a=a.split("!"),e=z.length,f=a.pop(),g=a.length,f={url:f,origUrl:f,prefixes:a};for(c=0;g>c;c++)d=a[c].split("="),(b=B[d.shift()])&&(f=b(f,d));for(c=0;e>c;c++)f=z[c](f);return f}function g(a,e,f,g,i){var j=b(a),l=j.autoCallback;j.url.split(".").pop().split("?").shift(),j.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]||h),j.instead?j.instead(a,e,f,g,i):(A[j.url]?j.noexec=!0:A[j.url]=1,f.load(j.url,j.forceCSS||!j.forceJS&&"css"==j.url.split(".").pop().split("?").shift()?"c":c,j.noexec,j.attrs,j.timeout),(d(e)||d(l))&&f.load(function(){k(),e&&e(j.origUrl,i,g),l&&l(j.origUrl,i,g),A[j.url]=2})))}function i(a,b){function c(a,c){if(a){if(e(a))c||(l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}),g(a,l,b,0,j);else if(Object(a)===a)for(i in h=function(){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}(),a)a.hasOwnProperty(i)&&(!c&&!--h&&(d(l)?l=function(){var a=[].slice.call(arguments);m.apply(this,a),n()}:l[i]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),n()}}(m[i])),g(a[i],l,b,i,j))}else!c&&n()}var h,i,j=!!a.test,k=a.load||a.both,l=a.callback||f,m=l,n=a.complete||f;c(j?a.yep:a.nope,!!k),k&&c(k)}var j,l,n=this.yepnope.loader;if(e(a))g(a,0,n,0);else if(y(a))for(j=0;j<a.length;j++)l=a[j],e(l)?g(l,0,n,0):y(l)?m(l):Object(l)===l&&i(l,n);else Object(a)===a&&i(a,n)},m.addPrefix=function(a,b){B[a]=b},m.addFilter=function(a){z.push(a)},m.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",l=function(){b.removeEventListener("DOMContentLoaded",l,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k,l,n=b.createElement("script"),e=e||m.errorTimeout;n.src=a;for(l in d)n.setAttribute(l,d[l]);c=j?h:c||f,n.onreadystatechange=n.onload=function(){!k&&g(n.readyState)&&(k=1,c(),n.onload=n.onreadystatechange=null)},o(function(){k||(k=1,c(1))},e),i?n.onload():p.parentNode.insertBefore(n,p)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(p.parentNode.insertBefore(e,p),o(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("audiodata",!!window.Audio),Modernizr.addTest("webaudio",!(!window.webkitAudioContext&&!window.AudioContext)),Modernizr.addTest("fullscreen",function(){for(var a=0;a<Modernizr._domPrefixes.length;a++)if(document[Modernizr._domPrefixes[a].toLowerCase()+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1}),Modernizr.addTest("raf",!!Modernizr.prefixed("requestAnimationFrame",window)),Mouse.prototype.isOverBall=function(a){var b=!1;return this.x>0&&this.y>0&&a.x>0&&a.y>0&&this.x>=a.x-a.radius&&this.x<=a.x+a.radius&&this.y>=a.y-a.radius&&this.y<=a.y+a.radius&&(b=!0,this.game.debug&&console.log("over "+this.x+" "+this.y)),b},Mouse.prototype.isOverPiece=function(a){var b=new Array;b[0]=new Point2D(a.position.x,a.position.y),b[1]=new Point2D(a.position.x+a.img.width,a.position.y),b[2]=new Point2D(a.position.x+a.img.width,a.position.y+a.img.height),b[3]=new Point2D(a.position.x,a.position.y+a.img.height),pt=new Point2D(this.x,this.y);for(var c=!1,d=-1,e=b.length,f=e-1;++d<e;f=d)(b[d].y<=pt.y&&pt.y<b[f].y||b[f].y<=pt.y&&pt.y<b[d].y)&&pt.x<(b[f].x-b[d].x)*(pt.y-b[d].y)/(b[f].y-b[d].y)+b[d].x&&(c=!c);return this.game.debug&&console.log("over "+a.id+": "+c),c},Mouse.prototype.isOverRect=function(a,b,c,d){var e=new Array;e[0]=a,e[1]=b,e[2]=c,e[3]=d,pt=new Point2D(this.x,this.y);for(var f=!1,g=-1,h=e.length,i=h-1;++g<h;i=g)(e[g].y<=pt.y&&pt.y<e[i].y||e[i].y<=pt.y&&pt.y<e[g].y)&&pt.x<(e[i].x-e[g].x)*(pt.y-e[g].y)/(e[i].y-e[g].y)+e[g].x&&(f=!f);return f},Mouse.prototype.onPointerMove=function(a){this.x=a.x/this.game.scale,this.y=a.y/this.game.scale,this.moving=!0,interv(),this.event=a,this.game.debug&&console.log("move: "+this.x+", "+this.y)},Mouse.prototype.onPointerDown=function(a){this.game.debug&&console.log("onPointerDown"),this.x=a.x/this.game.scale,this.y=a.y/this.game.scale,this.down=!0,this.up=!1,this.event=a,this.game.over&&(this.game.selected=this.game.over);var b=!1;this.game.debug&&console.log(this.game.puzzle.pieces.length);for(var c=0;c<this.game.puzzle.pieces.length;c++)piece=this.game.puzzle.pieces[c],piece.placed||(!b&&this.isOverPiece(piece)&&(b=!0),b&&!this.game.selected&&(this.game.over=piece,this.game.selected=this.game.over));this.game.debug&&console.log("down ("+this.game.over.id+") "+this.x+", "+this.y)},Mouse.prototype.onPointerUp=function(a){this.x=a.x/this.game.scale,this.y=a.y/this.game.scale,this.up=!0,this.down=!1,this.event=a,this.game.selected&&this.game.selected.near()&&!this.game.selected.placed?(this.game.selected.position.x=this.game.selected.holder.position.x,this.game.selected.position.y=this.game.selected.holder.position.y,this.game.selected.placed=!0,this.game.selected.moveble=!1,this.game.placed_pieces.push(this.game.selected),0!=this.game.drip.currentTime&&(this.game.drip.currentTime=0),iOS||(this.game.drip.src="/audio/drip.mp3",this.game.drip.play())):this.game.selected&&!this.game.selected.near()&&(this.game.selected.p=0,this.game.selected.moveble=!1,this.game.selected.placed=!1,iOS?(this.game.twang.src="/audio/twang.mp3",this.game.twang.play()):this.game.twang.play()),this.game.selected=null,this.game.debug&&console.log("up")},Point2D.prototype.clone=function(){return new Point2D(this.x,this.y)},Point2D.prototype.add=function(a){return new Point2D(this.x+a.x,this.y+a.y)},Point2D.prototype.addEquals=function(a){return this.x+=a.x,this.y+=a.y,this},Point2D.prototype.offset=function(a,b){var c=0;if(!(b.x<=this.x||this.x+a.x<=0)){var d,e,f=b.x*a.y-a.x*b.y;f>0?this.x<0?(d=this.x*a.y,e=d/a.x-this.y):this.x>0?(d=this.x*b.y,e=d/b.x-this.y):e=-this.y:b.x<this.x+a.x?(d=(b.x-this.x)*a.y,e=b.y-(this.y+d/a.x)):b.x>this.x+a.x?(d=(a.x+this.x)*b.y,e=d/b.x-(this.y+a.y)):e=b.y-(this.y+a.y),e>0&&(c=e)}return c},Point2D.prototype.rmoveto=function(a,b){this.x+=a,this.y+=b},Point2D.prototype.scalarAdd=function(a){return new Point2D(this.x+a,this.y+a)},Point2D.prototype.scalarAddEquals=function(a){return this.x+=a,this.y+=a,this},Point2D.prototype.subtract=function(a){return new Point2D(this.x-a.x,this.y-a.y)},Point2D.prototype.subtractEquals=function(a){return this.x-=a.x,this.y-=a.y,this},Point2D.prototype.scalarSubtract=function(a){return new Point2D(this.x-a,this.y-a)},Point2D.prototype.scalarSubtractEquals=function(a){return this.x-=a,this.y-=a,this},Point2D.prototype.multiply=function(a){return new Point2D(this.x*a,this.y*a)},Point2D.prototype.multiplyEquals=function(a){return this.x*=a,this.y*=a,this},Point2D.prototype.divide=function(a){return new Point2D(this.x/a,this.y/a)},Point2D.prototype.divideEquals=function(a){return this.x/=a,this.y/=a,this},Point2D.prototype.compare=function(a){return this.x-a.x||this.y-a.y},Point2D.prototype.eq=function(a){return this.x==a.x&&this.y==a.y},Point2D.prototype.lt=function(a){return this.x<a.x&&this.y<a.y},Point2D.prototype.lte=function(a){return this.x<=a.x&&this.y<=a.y},Point2D.prototype.gt=function(a){return this.x>a.x&&this.y>a.y},Point2D.prototype.gte=function(a){return this.x>=a.x&&this.y>=a.y},Point2D.prototype.lerp=function(a,b){return new Point2D(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},Point2D.prototype.distanceFrom=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},Point2D.prototype.min=function(a){return new Point2D(Math.min(this.x,a.x),Math.min(this.y,a.y))},Point2D.prototype.max=function(a){return new Point2D(Math.max(this.x,a.x),Math.max(this.y,a.y))},Point2D.prototype.toString=function(){return this.x+","+this.y},Point2D.prototype.setXY=function(a,b){this.x=a,this.y=b},Point2D.prototype.setFromPoint=function(a){this.x=a.x,this.y=a.y},Point2D.prototype.swap=function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},Piece.prototype.draw=function(){this.moveble||this.placed?(this.game.context.save(),this.game.context.globalAlpha=this.placed?1:this.game.is_over?1:.8,this.game.context.fillStyle="rgba(255, 255, 255, 0.5)",this==this.game.selected?this.game.context.fillStyle="rgba(0, 0, 255, 0.1)":this.game.over==this&&(this.game.context.fillStyle="rgba(255, 0, 0, 0.1)"),this.near()&&this==this.game.selected&&(this.game.context.fillStyle="rgba(0, 255, 0, 0.1)",1!=this.game.auto_snap||this.placed||(this.game.selected.position.x=this.game.selected.holder.position.x,this.game.selected.position.y=this.game.selected.holder.position.y,this.game.selected.placed=!0,this.game.selected.moveble=!1,this.game.placed_pieces.push(this.game.selected),iOS?(game.drip.src="/audio/drip.mp3",game.drip.play()):(game.drip.src="/audio/drip.mp3",game.drip.play()))),this.game.context.beginPath(),this.game.context.drawImage(this.img,this.position.x,this.position.y),this.game.context.closePath(),this.game.context.restore()):(this.position.x=this.initial.x,this.position.y=this.initial.y,this.moveble=!0,this.game.context.save(),this.game.context.globalAlpha=1,this.game.context.beginPath(),this.game.context.drawImage(this.img,this.position.x/this.game.scale,this.position.y/this.game.scale))},Piece.prototype.near=function(){var a=!1,b=this.position.x-this.holder.position.x,c=this.position.y-this.holder.position.y,d=b*b+c*c;return d<=this.tolerance&&(a=!0),a},Piece.prototype.mouse_is_over=function(){return this.game.mouse.isOverPiece(this)},Holder.prototype.draw=function(){this.game.context.save(),this.game.context.drawImage(this.img,this.position.x,this.position.y),this.game.context.restore()},Game.prototype.loadAssets=function(){console.log("start loading..."),this.assets=Array({type:"audio",src:"audio/drip",slug:"drip"},{type:"audio",src:"audio/twang",slug:"twang"},{type:"audio",src:"audio/01_Alex_Must_Once_Upon_a_Time",slug:"bgm"},{type:"audio",src:"audio/chimes",slug:"chimes"}),this.items_to_load=this.assets.length,loadAssetsI(this,this.assets)},Game.prototype.init=function(){console.log("loading done!"),console.log("initing..."),clearTimeout(this.iniTimeout),this.resized&&this.apply_scale(),this.loaded=!0,this.auto_snap=!0,this.pieces=new Array,this.holders=new Array,this.placed_pieces=new Array,this.moving=!0,this.selected=null,this.over=null,this.is_over=!1,this.num_pieces=5,this.clock_interval=null,this.mouse=new Mouse(this),this.puzzles=[new Puzzle("001",this,"images/001/2ce541a1.001.png",new Array("images/001/217f53e4.p01.png","images/001/5f339d6b.p02.png","images/001/4bdd3915.p03.png","images/001/fff4ccfa.p04.png","images/001/ed088b9c.p05.png","images/001/00a9d894.p06.png","images/001/c83817f1.p07.png"),new Array("images/001/6faa11ea.h01.png","images/001/ed6ee8e2.h02.png","images/001/1d011158.h03.png","images/001/b055de6d.h04.png","images/001/8fdf3ad5.h05.png","images/001/9dcb0d3e.h06.png","images/001/2acf7e65.h07.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-153,this.canvas.height/2-173.5),new Array(new Point2D(-8,40),new Point2D(81,26),new Point2D(83,60),new Point2D(76,110),new Point2D(48,190),new Point2D(165,187),new Point2D(12,260))),new Puzzle("002",this,"images/002/33d8899e.002.png",new Array("images/002/9462cee9.p01.png","images/002/92040e1f.p02.png","images/002/29413bc5.p03.png","images/002/6c16afc0.p04.png","images/002/a5f78788.p05.png","images/002/91f423d2.p06.png","images/002/f7efbb47.p07.png","images/002/26087656.p08.png","images/002/15635036.p09.png"),new Array("images/002/e9d6d70f.h01.png","images/002/d8ecb61b.h02.png","images/002/88e60980.h03.png","images/002/454d0fa9.h04.png","images/002/72d42e12.h05.png","images/002/f15d2058.h06.png","images/002/375a4111.h07.png","images/002/fc327da1.h08.png","images/002/1edecf47.h09.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-237.5+20,this.canvas.height/2-188+32),new Array(new Point2D(-35,68),new Point2D(-65,131),new Point2D(127,55),new Point2D(206,50),new Point2D(206,138),new Point2D(255,214),new Point2D(194,222),new Point2D(119,202),new Point2D(55,188))),new Puzzle("003",this,"images/003/4149e111.003.png",new Array("images/003/4890d8d6.p01.png","images/003/85b583d0.p02.png","images/003/94659799.p03.png","images/003/e1b6a41a.p04.png","images/003/058d4dfd.p05.png","images/003/56339c21.p06.png","images/003/7d4e761d.p07.png","images/003/cc4e870e.p08.png","images/003/0ff1bda3.p09.png","images/003/55cda99f.p10.png"),new Array("images/003/21379a68.h01.png","images/003/bc0317b1.h02.png","images/003/389ec54a.h03.png","images/003/f93af104.h04.png","images/003/607d2851.h05.png","images/003/070ca5b3.h06.png","images/003/a78af89f.h07.png","images/003/0cc58a1d.h08.png","images/003/a9915283.h09.png","images/003/63f52d8f.h10.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-151.5,this.canvas.height/2-177.5-5),new Array(new Point2D(91,20),new Point2D(11,43),new Point2D(92,107),new Point2D(-4,165),new Point2D(-5,223),new Point2D(50,216),new Point2D(140,229),new Point2D(190,301),new Point2D(137,300),new Point2D(35,297))),new Puzzle("006",this,"images/006/2099024e.006.png",new Array("images/006/0ac7a950.p01.png","images/006/70159d53.p02.png","images/006/8c7f4331.p03.png","images/006/be7ec35f.p04.png"),new Array("images/006/63c55ae6.h01.png","images/006/76135a41.h02.png","images/006/c3dfc07f.h03.png","images/006/49c64cf3.h04.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-149+5,this.canvas.height/2-200+5),new Array(new Point2D(82,0),new Point2D(0,193),new Point2D(166,283),new Point2D(65,127))),new Puzzle("008",this,"images/008/1af8b324.008.png",new Array("images/008/a439be8e.p01.png","images/008/0f5c6a41.p02.png","images/008/a1a39ced.p03.png","images/008/4f9df002.p04.png"),new Array("images/008/6eab8564.h01.png","images/008/b6ab8507.h02.png","images/008/fed6de09.h03.png","images/008/7a0b21a8.h04.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-213.5+5,this.canvas.height/2-216.5+5),new Array(new Point2D(28,0),new Point2D(0,257),new Point2D(58,109),new Point2D(185,0))),new Puzzle("005",this,"images/005/c482e17c.005.png",new Array("images/005/afeefbd7.p01.png","images/005/d73e487e.p02.png","images/005/b16674a6.p03.png","images/005/92ee50a1.p04.png","images/005/992c03b4.p05.png"),new Array("images/005/646d2725.h01.png","images/005/dfa628ed.h02.png","images/005/34f1cbf1.h03.png","images/005/5d3ccb36.h04.png","images/005/34b21e6a.h05.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-173+2,this.canvas.height/2-212.5+5),new Array(new Point2D(40,0),new Point2D(28,37),new Point2D(176,37),new Point2D(0,186),new Point2D(175,179))),new Puzzle("016",this,"images/016/198561ca.016.png",new Array("images/016/ac1c9117.p01.png","images/016/85d8dc0a.p02.png","images/016/d3fc538c.p03.png","images/016/c6ffd018.p04.png"),new Array("images/016/e69e2846.h01.png","images/016/b7aad440.h02.png","images/016/4544af25.h03.png","images/016/2779f6d9.h04.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-248.5,this.canvas.height/2-250+2),new Array(new Point2D(73,0),new Point2D(98,157),new Point2D(0,268),new Point2D(169,329))),new Puzzle("011",this,"images/011/a83dc87a.011.png",new Array("images/011/29ee260e.p01.png","images/011/c4991375.p02.png","images/011/19122e33.p03.png","images/011/3f63c625.p04.png","images/011/c011f5c2.p05.png"),new Array("images/011/16720246.h01.png","images/011/4450fcff.h02.png","images/011/043062fa.h03.png","images/011/5c0f9713.h04.png","images/011/d58384ea.h05.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-193,this.canvas.height/2-233+2),new Array(new Point2D(0,0),new Point2D(49,46),new Point2D(0,227),new Point2D(174,227),new Point2D(84,373))),new Puzzle("012",this,"images/012/4852acdc.012.png",new Array("images/012/890ef261.p01.png","images/012/7868198f.p02.png","images/012/db83e42b.p03.png","images/012/8f88530e.p04.png","images/012/2acf5f22.p05.png"),new Array("images/012/9791930c.h01.png","images/012/2676fa0d.h02.png","images/012/c7b036f0.h03.png","images/012/2ea802a7.h04.png","images/012/9d76ce83.h05.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-245,this.canvas.height/2-227+2),new Array(new Point2D(54,0),new Point2D(0,101),new Point2D(287,75),new Point2D(59,242),new Point2D(287,242))),new Puzzle("015",this,"images/015/42e49962.015.png",new Array("images/015/48b337a5.p01.png","images/015/8801b350.p02.png","images/015/9d214971.p03.png","images/015/45b38161.p04.png","images/015/afdc59f4.p05.png"),new Array("images/015/922dd166.h01.png","images/015/f00223a0.h02.png","images/015/b89d6a00.h03.png","images/015/9b2a15df.h04.png","images/015/ec5ed6d2.h05.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-149,this.canvas.height/2-200+2),new Array(new Point2D(365,0),new Point2D(238,184),new Point2D(115,105),new Point2D(-200,50),new Point2D(-62,157))),new Puzzle("004",this,"images/004/16276b37.004.png",new Array("images/004/307f0a95.p01.png","images/004/d1dddebf.p02.png","images/004/5bbbb20f.p03.png","images/004/92d581da.p04.png","images/004/1133f983.p05.png","images/004/9320e6b8.p06.png"),new Array("images/004/7ae32f05.h01.png","images/004/19ae9eb8.h02.png","images/004/a120a7a3.h03.png","images/004/285b1889.h04.png","images/004/e973e4fb.h05.png","images/004/e155152e.h06.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-233.5,this.canvas.height/2-166.5),new Array(new Point2D(0,173),new Point2D(49,66),new Point2D(207,0),new Point2D(286,24),new Point2D(115,120),new Point2D(170,115))),new Puzzle("007",this,"images/007/6f804539.007.png",new Array("images/007/259f10da.p01.png","images/007/b0986987.p02.png","images/007/ce6fcf24.p03.png","images/007/2804760a.p04.png","images/007/bc55cefb.p05.png","images/007/65086b66.p06.png"),new Array("images/007/1d7cc2f9.h01.png","images/007/9ac7c0ad.h02.png","images/007/5547458f.h03.png","images/007/49c603e9.h04.png","images/007/1825c543.h05.png","images/007/03773f24.h06.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-168.5+3,this.canvas.height/2-216.5+5),new Array(new Point2D(0,61),new Point2D(144,0),new Point2D(27,38),new Point2D(26,58),new Point2D(95,226),new Point2D(193,215))),new Puzzle("009",this,"images/009/67058014.009.png",new Array("images/009/b8293c8c.p01.png","images/009/ff81889f.p02.png","images/009/4a0a7c9f.p03.png","images/009/a1c5170c.p04.png","images/009/8f58715a.p05.png","images/009/68f68689.p06.png"),new Array("images/009/e85dc299.h01.png","images/009/143db88b.h02.png","images/009/72099ac2.h03.png","images/009/bd4b7620.h04.png","images/009/06a51d1d.h05.png","images/009/1169ead0.h06.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-212.5+5,this.canvas.height/2-333+10),new Array(new Point2D(79,0),new Point2D(0,118),new Point2D(54,512),new Point2D(294,538),new Point2D(102,346),new Point2D(247,341))),new Puzzle("010",this,"images/010/a6baaa5b.010.png",new Array("images/010/5cc3e0b5.p01.png","images/010/bbb51297.p02.png","images/010/2f0c5f85.p03.png","images/010/1ff85020.p04.png","images/010/8ddf773e.p05.png","images/010/0e818897.p06.png"),new Array("images/010/09740990.h01.png","images/010/565fdf27.h02.png","images/010/3f26d738.h03.png","images/010/40de6c2e.h04.png","images/010/f262fd28.h05.png","images/010/afc6e8ab.h06.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-158,this.canvas.height/2-223+2),new Array(new Point2D(4,0),new Point2D(12,90),new Point2D(0,276),new Point2D(162,272),new Point2D(12,363),new Point2D(162,363))),new Puzzle("013",this,"images/013/227b7d7a.013.png",new Array("images/013/72ce2de0.p01.png","images/013/8c14bc9f.p02.png","images/013/53d61bc6.p03.png","images/013/3bbd2908.p04.png","images/013/7848aa1f.p05.png","images/013/d65784ca.p06.png"),new Array("images/013/3df3a019.h01.png","images/013/59a89276.h02.png","images/013/210de8c0.h03.png","images/013/2953e3f6.h04.png","images/013/e82b82d4.h05.png","images/013/7206a1ca.h06.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-326.5,this.canvas.height/2-216.5+2),new Array(new Point2D(-200,112),new Point2D(175,0),new Point2D(-119,0),new Point2D(73,212),new Point2D(164,212),new Point2D(308,212))),new Puzzle("014",this,"images/014/ce0cd093.014.png",new Array("images/014/785d3e93.p01.png","images/014/93560c99.p02.png","images/014/99e19c6d.p03.png","images/014/6524e745.p04.png","images/014/24edfb29.p05.png","images/014/3f02c231.p06.png"),new Array("images/014/49ab463e.h01.png","images/014/b7cd7653.h02.png","images/014/680031cb.h03.png","images/014/4176d260.h04.png","images/014/cf61f60b.h05.png","images/014/703fcb78.h06.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-257.5,this.canvas.height/2-250+2),new Array(new Point2D(0,0),new Point2D(37,58),new Point2D(191,264),new Point2D(286,315),new Point2D(391,309),new Point2D(339,188))),new Puzzle("017",this,"images/017/a5561210.017.png",new Array("images/017/4589b62c.p01.png","images/017/8805d9eb.p02.png","images/017/a1dd3982.p03.png","images/017/bd3072d7.p04.png","images/017/fa65b169.p05.png","images/017/e01d2baf.p06.png"),new Array("images/017/11c3376a.h01.png","images/017/fc59427a.h02.png","images/017/00cf9cdc.h03.png","images/017/da02e6ed.h04.png","images/017/afa2123c.h05.png","images/017/4e463cda.h06.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-270,this.canvas.height/2-174+2),new Array(new Point2D(0,0),new Point2D(125,223),new Point2D(292,223),new Point2D(203,26),new Point2D(291,24),new Point2D(444,72))),new Puzzle("018",this,"images/018/131a0df9.018.png",new Array("images/018/a189f8cb.p01.png","images/018/d3415290.p02.png","images/018/44b5d7a3.p03.png","images/018/fce0a8d0.p04.png","images/018/9ea1dc44.p05.png","images/018/6263ca2a.p06.png"),new Array("images/018/bcac21d4.h01.png","images/018/ecc3d8b7.h02.png","images/018/5f919800.h03.png","images/018/1cdf830a.h04.png","images/018/8698e49e.h05.png","images/018/a55104e0.h06.png"),{has_voice:!0,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-335.5,this.canvas.height/2-228+2),new Array(new Point2D(0,225),new Point2D(274,225),new Point2D(435,186),new Point2D(206,0),new Point2D(206,186),new Point2D(87,47))),new Puzzle("019",this,"images/019/62626902.019.png",new Array("images/019/b290251a.p01.png","images/019/8569b2de.p02.png","images/019/3ac996b0.p03.png","images/019/6bb2c024.p04.png","images/019/191862e7.p05.png","images/019/92d38941.p06.png","images/019/fe285bbf.p07.png"),new Array("images/019/1cd2ab07.h01.png","images/019/3f6708aa.h02.png","images/019/c3272214.h03.png","images/019/ce0eb35c.h04.png","images/019/a14f8772.h05.png","images/019/3f392c30.h06.png","images/019/47c272f8.h07.png"),{has_voice:!0,has_sound:!0},{width:298,height:400},new Point2D(this.canvas.width/2-227.5,this.canvas.height/2-245+2),new Array(new Point2D(0,3),new Point2D(205,0),new Point2D(13,235),new Point2D(229,235),new Point2D(159,404),new Point2D(297,404),new Point2D(374,263))),new Puzzle("020",this,"images/020/afe1be2e.020.png",new Array("images/020/cac28c44.p01.png","images/020/7afc61db.p02.png","images/020/63bf851b.p03.png","images/020/275c3550.p04.png","images/020/92dd98b6.p05.png","images/020/45275e39.p06.png","images/020/501df925.p07.png","images/020/75873741.p08.png"),new Array("images/020/2bfef66b.h01.png","images/020/14810387.h02.png","images/020/bc8da39c.h03.png","images/020/7379f076.h04.png","images/020/8a84fba2.h05.png","images/020/1769d6e8.h06.png","images/020/aaf32920.h07.png","images/020/fcc9a16e.h08.png"),{has_voice:!1,has_sound:!1},{width:298,height:400},new Point2D(this.canvas.width/2-165,this.canvas.height/2-190-5),new Array(new Point2D(0,73),new Point2D(70,8),new Point2D(92,105),new Point2D(258,172),new Point2D(234,278),new Point2D(52,273),new Point2D(204,215),new Point2D(121,214)))],this.puzzle=this.puzzles[this.stage-1],this.puzzle.init()
},Game.prototype.render=function(){this.draw_bg(),this.loaded?this.puzzle.loaded?(this.puzzle.draw(),this.draw_remaining()):(this.draw_loading(),this.puzzle.items_to_load>0&&this.puzzle.loaded_items==this.puzzle.items_to_load&&(this.puzzle.items_to_load=0,this.puzzle.iniTimeout=setTimeout("game.puzzle.init();",3e3))):this.items_to_load>0&&this.loaded_items==this.items_to_load&&(this.items_to_load=0,this.init()),this.debug&&(void 0!=this.mouse&&(document.getElementById("mx").value=this.mouse.x,document.getElementById("my").value=this.mouse.y,document.getElementById("moving").value=this.mouse.moving),void 0!=this.puzzle&&(document.getElementById("hx").value=this.puzzle.holders[0].position.x,document.getElementById("hy").value=this.puzzle.holders[0].position.y,document.getElementById("hx2").value=this.puzzle.holders[1].position.x,document.getElementById("hy2").value=this.puzzle.holders[1].position.y,document.getElementById("px").value=this.puzzle.pieces[0].position.x,document.getElementById("py").value=this.puzzle.pieces[0].position.y,document.getElementById("p").value=this.puzzle.num_pieces),document.getElementById("over").value=this.over?this.over.id:"",document.getElementById("selected").value=this.selected?this.selected.id:"",this.loaded&&(document.getElementById("pp").value=this.placed_pieces.length))},Game.prototype.draw_bg=function(){this.scale||(this.scale=1),this.context.fillStyle="rgba(125, 125, 125, 1)",this.context.fillRect(0,0,this.canvas.width/this.scale,this.canvas.height/this.scale),this.placed_pieces&&(this.context.save(),grad=this.context.createRadialGradient(this.canvas.width/this.scale/2,this.canvas.height/this.scale/2,0,this.canvas.width/this.scale/2,this.canvas.height/this.scale/2,this.canvas.width/this.scale),this.puzzle.num_pieces>this.placed_pieces.length?(grad.addColorStop(1,["rgb(",256,", ",256,", ",256,")"].join("")),grad.addColorStop(0,["rgb(",100,", ",100,", ",100,")"].join(""))):(grad.addColorStop(0,["rgb(",256,", ",256,", ",256,")"].join("")),grad.addColorStop(1,["rgb(",100,", ",100,", ",100,")"].join(""))),this.context.fillStyle=grad,this.context.fillRect(0,0,this.canvas.width/this.scale,this.canvas.height/this.scale),this.context.restore())},Game.prototype.draw_remaining=function(){this.context.save(),this.fade1=this.fade1+.01*this.alpha,this.fade1>=.6?this.alpha=-1:this.fade1<=.2&&(this.alpha=1),this.context.fillStyle="rgba(255, 255, 255, "+this.fade1+")",this.context.strokeStyle="rgba(0, 0, 0, 0.5)",this.context.lineWidth=2,this.context.font="bold "+this.font_size+"px Arial",this.context.textBaseline="top",this.context.textAlign="left",this.context.strokeText(this.puzzle.remaining_time,10,40),this.context.fillText(this.puzzle.remaining_time,10,40);var a=this.context.measureText(this.stage+"/"+this.puzzles.length+" ");this.context.strokeText(this.stage+"/"+this.puzzles.length,this.canvas.width/this.scale-a.width,40),this.context.fillText(this.stage+"/"+this.puzzles.length,this.canvas.width/this.scale-a.width,40),this.context.restore()},Game.prototype.draw_loading=function(){this.fade1=this.fade1+.025,this.fade1>=1&&(this.fade1=0),this.fade2=1-this.fade1,this.context.fillStyle="rgba(255, 255, 255, "+this.fade2+")",this.context.strokeStyle="rgba(255, 255, 255, "+this.fade1+")",this.context.font="bold "+this.font_size+"px Arial",this.context.textBaseline="middle",this.context.textAlign="center",this.context.lineWidth=5,this.context.strokeText("LOADING",this.canvas.width/this.scale/2,this.canvas.height/this.scale/2),this.context.fillText("LOADING",this.canvas.width/this.scale/2,this.canvas.height/this.scale/2)},Game.prototype.apply_scale=function(){var a=this.original_width,b=this.original_height;void 0!=game.puzzle.width&&(a=2*game.puzzle.width,b=2*game.puzzle.height),document.getElementById("canvas").width=window.innerWidth,document.getElementById("canvas").height=window.innerHeight;var c=document.getElementById("canvas").width/a,d=document.getElementById("canvas").height/b;this.scale=Math.min(c,d),this.context.scale(this.scale,this.scale),this.resized=!1},Game.prototype.getTimer=function(){return(new Date).getTime()-this.start_time},Game.prototype.restart=function(){this.resized=!0,this.init()},Game.prototype.nextStage=function(){this.puzzles.length<this.stage+1?(this.is_over=!0,stopGame()):(this.is_over=!1,this.stage++,this.num_lines++,this.init(),startGame())},Puzzle.prototype.loadAssets=function(){for(this.img=new Image,this.img.src=this.image,this.img.onload=this.loaded_items++,i=0;i<this.num_pieces;i++){var a=new Image;a.src=this.imgh[i],a.onload=this.loaded_items++;var b=this.placeHolder(i,a),c=new Image;c.src=this.imgp[i],c.onload=this.loaded_items++,this.placePiece(i,c,b)}var d=[];this.has_voice?($("#btn_voice").show(),d.push({type:"audio",src:"images/"+this.id+"/voice",slug:"voice"})):$("#btn_voice").hide(),this.has_sound?($("#btn_sound").show(),d.push({type:"audio",src:"images/"+this.id+"/sound",slug:"sound"})):$("#btn_sound").hide(),(this.has_voice||this.has_sound)&&(this.itens_to_load2=d.length,loadAssetsII(this,d))},Puzzle.prototype.init=function(){console.log("initing puzzle..."),this.loaded=!1,this.loadAssets(),clearTimeout(this.iniTimeout),this.loaded=!0,this.solved=!1},Puzzle.prototype.placePiece=function(a,b,c){x=Math.floor(Math.random()*(this.game.canvas.width/this.game.scale-b.width)),y=Math.floor(Math.random()*(this.game.canvas.height/this.game.scale-b.height)),80>y&&(y+=80),y>this.game.canvas.height-20&&(y-=80),80>x&&(x+=80),x>this.game.canvas.width-80&&(x-=80),temp=new Piece(a,this.game,b,c,new Point2D(x,y),new Point2D(x,y),!0,!1),this.pieces.push(temp)},Puzzle.prototype.placeHolder=function(a,b){this.pos.xx=this.game.canvas.width/this.game.scale/2-this.width/2,this.pos.yy=this.game.canvas.height/this.game.scale/2-this.height/2;var c=this.positions[a].x+this.pos.xx,d=this.positions[a].y+this.pos.yy;return temp=new Holder(a,this.game,b,new Point2D(c,d),!1),this.holders.push(temp),temp},Puzzle.prototype.draw=function(){if(this.solved)$("#stage").html("Stage "+this.game.stage+" completed!"),$("#pieces").html(this.num_pieces+" pieces in "+(this.time_to_complete-this.remaining_time)+"s"),this.solved=!1,pauseClock(),iOS?(console.log("iOS"),$("#modal-success").css("top","0px"),$("#modal-success").addClass("show")):this.has_voice&&this.has_sound?(console.log("voice & sound"),this.voice.addEventListener("ended",function(){game.puzzle.sound.play()}),this.sound.addEventListener("ended",function(){$("#modal-success").css("top","0px"),$("#modal-success").addClass("show")}),game.puzzle.voice.play()):this.has_voice&&!this.has_sound?(console.log("voice only"),this.voice.addEventListener("ended",function(){$("#modal-success").css("top","0px"),$("#modal-success").addClass("show")}),game.puzzle.voice.play()):(game.chimes.play(),console.log("none"),$("#modal-success").css("top","0px"),$("#modal-success").addClass("show"));else if(this.num_pieces>this.game.placed_pieces.length){for(var a=0;a<this.holders.length;a++)this.holders[a].draw();for(var b=new Array,c=!1,a=0;a<this.pieces.length;a++)piece=this.pieces[a],piece.placed?piece!=this.game.selected&&piece.draw():b.push(piece);c||(this.game.over=null),null!=this.game.selected&&this.game.selected.moveble&&(this.game.selected.x=this.game.mouse.x,this.game.selected.y=this.game.mouse.y);for(var a=0;a<b.length;a++)b[a].draw();this.game.selected&&this.game.selected.draw(),null!=this.game.selected&&this.game.selected.moveble&&(this.game.selected.position.x=this.game.mouse.x-this.game.selected.img.width/2,this.game.selected.position.y=this.game.mouse.y-this.game.selected.img.height/2),this.remaining_time<=0?(stopGame(),confirm("Timeup! Game Over! Wanna try again?")&&(this.game.is_over=!1,this.game.init(),startGame())):this.game.is_over||this.num_pieces==this.game.placed_pieces.length&&(this.game.is_over=!0,this.solved=!0)}else this.game.context.drawImage(this.img,this.game.canvas.width/this.game.scale/2-this.img.width/2,this.game.canvas.height/this.game.scale/2-this.img.height/2),pauseGame()},iOS=!1,p=navigator.platform,("iPad"===p||"iPhone"===p||"iPhone Simulator"===p||"iPod"===p)&&(iOS=!0),console.log("iOS? "+iOS),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.log("!window.requestAnimationFrame"),window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,22-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Modernizr.fullscreen;var game=new Game,interval=null,gameInterval=null;game.debug=!0,interv=function(){interval=setTimeout("game.mouse.moving = false; document.getElementById('moving').value = false; intervClear();",1e3)},intervClear=function(){clearInterval(interval)},stopGame=function(){clearInterval(gameInterval),game.started=!1,stopSFX(),stopBGM(),window.cancelAnimationFrame(game.interval),$("#home").addClass("active"),$("#canvas, #canvas_bg, .abs, .control, #modal-success").hide(),$("#play, .content, .container").show(),$("#body").css("padding-top","20px"),$("#body").css("margin-bottom","20px")},startGame=function(){window.scrollTo(0,0),gameInterval=setInterval(function(){game.puzzle.remaining_time--},1e3),game.started=!0,startSFX(),startBGM(),loop(),game.drip.play(),$("#modal-success").removeClass("show"),$("#canvas, .control, .abs").show(),$(".content, #play, #exitfullscreen, #bgm, #sfx, #autosnap").hide(),$(".container, .footer").hide(),$("#body").css("padding","0px"),$("#body").css("margin","0px")},pauseGame=function(){clearInterval(gameInterval),game.started=!1,window.cancelAnimationFrame(game.interval),$("#play").show(),$(".control").hide()},pauseClock=function(){clearInterval(gameInterval),game.started=!1},restartGame=function(){game.restart()},stopSFX=function(){game.drip.volume=0,game.twang.volume=0,game.drip.pause(),game.twang.pause(),$("#sfxoff").hide(),$("#sfx").show()},startSFX=function(){game.drip.volume=1,game.twang.volume=1,$("#sfxoff").show(),$("#sfx").hide()},stopBGM=function(){game.bgm.volume=0,game.bgm.pause(),$("#bgmoff").hide(),$("#bgm").show()},startBGM=function(){iOS?($("#bgmoff").show(),$("#bgm").hide(),game.bgm.currentTime<=0&&(game.bgm.src="/audio/01_Alex_Must_Once_Upon_a_Time.mp3",game.bgm.play()),console.log("startBGM-ios")):(game.bgm.volume=1,game.bgm.play(),$("#bgmoff").show(),$("#bgm").hide(),console.log("startBGM"))},autoSnap=function(){game.auto_snap=!0,$("#autosnapoff").show(),$("#autosnap").hide()},autoSnapOff=function(){game.auto_snap=!1,$("#autosnapoff").hide(),$("#autosnap").show()},fullscreen=function(){RunPrefixMethod(game.canvas,"RequestFullScreen")},exitfullscreen=function(){RunPrefixMethod(document,"CancelFullScreen")},window.addEventListener("resize",resizeGame,!1),window.addEventListener("orientationchange",resizeGame,!1),$(function(){$("#next").click(function(){iOS||(game.puzzle.has_voice&&(game.puzzle.voice.pause(),game.puzzle.voice.currentTime=0,$("#btn_voice").removeClass("disabled")),game.puzzle.has_sound&&(game.puzzle.sound.pause(),game.puzzle.sound.currentTime=0,$("#btn_sound").removeClass("disabled"))),game.nextStage(),$("#modal-success").fadeOut()}),$("#btn_voice").click(function(){game.puzzle.has_voice&&!$("#btn_voice").hasClass("disabled")&&(game.puzzle.voice.addEventListener("ended",function(){$("#btn_voice").removeClass("disabled")}),$("#btn_voice").addClass("disabled"),game.puzzle.voice.play())}),$("#btn_sound").click(function(){game.puzzle.has_sound&&!$("#btn_sound").hasClass("disabled")&&(game.puzzle.sound.addEventListener("ended",function(){$("#btn_sound").removeClass("disabled")}),$("#btn_sound").addClass("disabled"),game.puzzle.sound.play())}),$("#play, #btn-play, #play-btn-lg").click(function(){start()}),$("#btn-pause").click(function(){pause()}),$("#btn-fullscreen").click(function(){fullscreen()}),$("#btn-exitfullscreen").click(function(){exitfullscreen()}),$("#btn-bmg-on").click(function(){startBGM()}),$("#btn-bmg-off").click(function(){stopBGM()}),$("#btn-sfx-on").click(function(){startSFX()}),$("#btn-sfx-off").click(function(){stopSFX()}),$("#btn-autosnap-on").click(function(){autoSnap()}),$("#btn-autosnap-off").click(function(){autoSnapOff()}),$("#play-top").click(function(){start()}),$("#modal-success").css("height",game.canvas.height+"px"),$("#btn-home").click(function(){self.location.href="./index.html"})});